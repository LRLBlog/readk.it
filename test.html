<!DOCTYPE html>
<html>
<head>
<title>Load Page in Iframe Using Query String Data</title>
<style type="text/css">
body { font: 14px/1.3 verdana, arial, helvetica, sans-serif; }
h1 { font-size:1.3em; }
a:link { color:#33c; } 
a:visited { color:#339; }
ul li { margin-bottom:.3em; }  

iframe#ifrm {
    border:1px solid #ccc;
    width:600px; height:200px;
    margin:1em 0;
    }   
</style>

<script src="js/lib/jquery-1.8.3.min.js"></script>

</head>
<body>

<h1>Obtain Iframe src from Query String Data</h1>

<!-- iframe with id and default page in src -->
<iframe seamless name="ifrm" id="ifrm" src="html/thirdparty/30/accessible_epub_3/EPUB/ch03s02.xhtml">Your browser doesn't support iframes.</iframe>
<iframe seamless name="ifrm2" id="ifrm2" src="test.manifest.js.html">Your browser doesn't support iframes.</iframe>

<script type="text/javascript">
// free code from dyn-web.com 
// http://www.dyn-web.com/tutorials/iframes/query.php

var dw_Util; 
if (!dw_Util) dw_Util = {};

// obj: link or window.location
dw_Util.getValueFromQueryString = function (name, obj) {
    obj = obj? obj: window.location; 
    if (obj.search && obj.search.indexOf(name != -1) ) {
        var pairs = obj.search.slice(1).split("&"); // name/value pairs
        var set;
        for (var i=0; pairs[i]; i++) {
            set = pairs[i].split("="); // Check each pair for match on name 
            if ( set[0] == name && set[1] ) {
                return set[1];
            }
        }
    }
    return '';
}

// example query string for 2 iframes: ?ifrm=dw&ifm2=cd
function checkQuery4Iframe(obj) {
    var id = obj.id, urls = obj.urls, pg, url;
    // value for id in query string?
    pg = dw_Util.getValueFromQueryString(id);
    // value found for id? in list of urls? if not, use default 
    url = ( pg && urls[pg] )? urls[pg]: urls['dflt']
    document.getElementById(id).src = url;
}

function load_iframe_using_javascript(obj){
    //document.getElementById(obj.id).src = obj.urls.new;
    document.getElementById(obj.id).src = manifest[1].file;
}

function inject_into_iframe(iframe_name) {
    var iframe = document.getElementById(iframe_name);
    var content = iframe.contentWindow.document.body.innerHTML;
    alert('content: ' + content);   

}

var message_request = function (msg){
    msg.source.postMessage('{"id": "ifrm2", "response": "' + manifest[1].root + manifest[1].opf.spine[1].itemref.href + '"}', "*");
};

window.addEventListener('message', function (e) {
    data = jQuery.parseJSON(e.data);
    document.getElementById(data.id).src = data.response;
}, false);


function post_message(iframe_id, message) {
    var iframe = document.getElementById(iframe_id);
    alert('posting: ' + message);
    iframe.contentWindow.postMessage(message, '*');
}

var iframe_props = {
    id: 'ifrm', // id of iframe
    urls: {
        // lookup values and urls to load in iframe 
        'dflt': 'chap01.html', // a default page
        // full URL example
        'ext': 'html/thirdparty/30/accessible_epub_3/EPUB/ch03s05.xhtml',
        'new': 'html/thirdparty/30/accessible_epub_3/EPUB/ch02s03.xhtml'
    }
}

// Call function below iframe on onload (or document.ready)
checkQuery4Iframe(iframe_props);

</script>

<p>This example <a href="?ifrm=ext">link</a> loads the first iframe based on query parameters.</p>

<p>This example <a href="#" onclick="javascript:load_iframe_using_javascript(iframe_props);return false;">link</a> simply uses javascript to change the document.location of the first iframe.</p>

<p>This example <a href="#" onclick="javascript:inject_into_iframe('ifrm');return false;">link</a> uses javascript to inject material into the content of  the first iframe.</p>

<p>This example <a href="#" onclick="javascript:post_message('ifrm', 'function alertme(){alert(\x22posted\x22);}');return false;">link</a> uses postmessage to communicate with the first iframe.</p>

<p>This example <a href="#" onclick="javascript:post_message('ifrm2', message_request.toString());return false;">link</a> uses postmessage to communicate with the second iframe.</p>

<p>More information is available <a href="http://www.dyn-web.com/tutorials/iframes/query/">online</a>.</p>

</body>
</html>
